<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Python 3.12.9 环境更新说明</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            line-height: 1.6;
            margin: 20px;
        }
        h1, h2, h3 {
            color: #333;
        }
        code {
            background-color: #f4f4f4;
            padding: 2px 5px;
            border-radius: 3px;
            font-family: monospace;
        }
        ul {
            list-style-type: square;
            margin-left: 20px;
        }
        .note {
            background-color: #f9f9f9;
            border-left: 4px solid #ccc;
            padding: 10px;
            margin: 10px 0;
        }
    </style>
</head>
<body>

<h1>Python 3.12.9 环境更新说明</h1>

<p>基于 Python 3.12.9 环境，集成了 Python 版本的 <code>customLib</code>，主要适配项包括：</p>

<h2>1. 第三方库的重新筛选</h2>
<ul>
    <li>原来 <code>requirements</code> 文件中第三方库的重新筛选，必须用的会保留，其他的开发者可以使用虚拟环境开发调试，并且以后请尽量使用 Python 原生库。</li>
</ul>

<h2>2. uiautomator2 更新至 3.2.8 版本</h2>
<ul>
    <li><code>connectDevice</code> 接口内部变更</li>
    <li><code>swipe</code> 滑动接口变更</li>
    <li><code>scroll_to_element_by_xpath</code> 接口变更</li>
    <li>添加 <code>clear_element_text_by_resourceId</code>，之前的 <code>by_xpath</code> 不再支持</li>
    <li><code>get_element_all_info_by_resourceid</code> 接口变更</li>
    <li><code>show_toast</code> 接口不再支持</li>
    <li>添加 <code>get_checked_info_by_resource_id</code> 接口，替换之前中科的 AT 接口</li>
    <li><code>watcher</code>：由于内部轮询机制，无法立即停止 <code>watcher</code>，需要上层在 <code>callback</code> 方法中使用标志位来保证 <code>callback</code> 只执行一次</li>
</ul>

<h2>3. 安卓控件元素信息捕获</h2>
<p>使用新引入的 <code>uiautodev</code> 库，在新的 Python 环境下，执行 <code>python -m uiautodev</code> 调起页面进行开发。</p>

<h2>4. 第三方库升级</h2>
<ul>
    <li><code>paramiko</code> 升级到了 3.5.0</li>
    <li><code>openpyxl</code> 升级到了 3.1.0，以免运行时报错</li>
</ul>

<h2>5. 代码语法适配</h2>
<ul>
    <li><code>invalid escape sequence</code> 报错：在代码中在转义字符串前面添加 <code>r</code></li>
    <li><code>FutureWarning: DataFrame.applymap has been deprecated. Use DataFrame.map instead.</code> 警告：需要调用者更新 <code>pandas</code> 接口</li>
</ul>

<h2>6. 一键部署脚本更新</h2>
<p>修改了下载 2 个代码分仓的逻辑，并会自动添加 <code>adb</code> 和新 Python 环境的环境变量；执行前需要将 <code>GIT</code> 安装目录下的 <code>bin</code> 添加到 <code>PATH</code> 环境变量。</p>

<h2>TODO</h2>
<ul>
    <li>需要大家适配各自的 <code>case</code></li>
    <li>继续对应和适配上面第 5 点中因为 Python 环境变更出现的问题</li>
</ul>

<h2>手动更新环境步骤</h2>
<ol>
    <li>更新 <code>pycharm</code> 版本到 2024.3</li>
    <li>如果本地 <code>case</code> 库不存在，下载 <code>automation_cases</code> 库，即执行 <code>git clone https://xxxxxx@info-gerrit.apps.saic-gm.com/a/automationCase ./automation_cases</code> 指令，其中 <code>xxxxxx</code> 为用户账号</li>
    <li>下载 <code>automation_lib</code> 库，建议和之前的 <code>automation_cases</code> 目录在同一目录下，即执行 <code>git clone https://xxxxxx@info-gerrit.apps.saic-gm.com/a/automationLib ./automation_lib</code> 指令，其中 <code>xxxxxx</code> 为用户账号</li>
    <li>在 <code>pycharm</code> 中分别导入 <code>case</code> 和 <code>lib</code> 库，选择新的 Python 执行器，路径为 <code>automation_lib/python-3.12.9-embed-amd64/python.exe</code></li>
    <li>根据具体车型信息更新 <code>config</code> 文件</li>
</ol>

<h2>bat 脚本更新步骤</h2>
<ol>
    <li>更新 <code>pycharm</code> 版本到 2024.3</li>
    <li>执行“桌面自动化部署更新.bat”脚本。磁盘目前指定为 D 盘，如需变更盘符可以直接修改代码</li>
    <li>在 <code>pycharm</code> 中分别导入 <code>case</code> 和 <code>lib</code> 库，选择新的 Python 执行器，路径为 <code>automation_lib/python-3.12.9-embed-amd64/python.exe</code></li>
    <li>根据具体车型信息更新 <code>config</code> 文件</li>
</ol>

<div class="note">
    <strong>注意：</strong> 请确保在执行脚本前，已将 <code>GIT</code> 安装目录下的 <code>bin</code> 添加到 <code>PATH</code> 环境变量。
</div>

</body>
</html>